# ================================================================
# OFELİA ZAMANLANMIŞ GÖREVLER
# ================================================================
# Airflow'un basit alternatifi. Cron syntax kullanır.
# Web arayüzü yok, sadece loglar: docker logs {MUSTERI_ADI}_scheduler
# ================================================================

# === GÖREV 1: ERP'den Veri Çek (Her gece saat 02:00) ===
[job-exec "erp_veri_cek"]
schedule = 0 2 * * *
container = ${MUSTERI_ADI}_dbt
command = python /usr/app/scripts/erp_to_clickhouse_v2.py
no-overlap = true

# === GÖREV 2: dbt Modellerini Çalıştır (Her gece saat 03:00) ===
[job-exec "dbt_calistir"]
schedule = 0 3 * * *
container = ${MUSTERI_ADI}_dbt
command = dbt run --profiles-dir /root/.dbt --project-dir /usr/app
no-overlap = true

# === GÖREV 3: Superset Cache Temizle (Her Pazar 04:00) ===
[job-exec "cache_temizle"]
schedule = 0 4 * * 0
container = ${MUSTERI_ADI}_redis
command = redis-cli FLUSHALL

# ================================================================
# CRON SYNTAX HATIRLATMA:
# ┌───────────── dakika (0 - 59)
# │ ┌───────────── saat (0 - 23)
# │ │ ┌───────────── gün (1 - 31)
# │ │ │ ┌───────────── ay (1 - 12)
# │ │ │ │ ┌───────────── haftanın günü (0 - 6, Pazar=0)
# │ │ │ │ │
# * * * * *
#
# Örnekler:
# 0 2 * * *     → Her gece saat 02:00
# 0 */4 * * *   → Her 4 saatte bir
# 0 9 * * 1     → Her Pazartesi 09:00
# 0 0 1 * *     → Her ayın 1'i gece yarısı
# ================================================================

# ================================================================
# ÖZEL AYARLAR (İhtiyaca göre)
# ================================================================

# Test için: Her 5 dakikada bir çalıştır (İLK KURULUMDA AKTİF EDIN!)
# [job-exec "test_veri_cek"]
# schedule = */5 * * * *
# container = ${MUSTERI_ADI}_dbt
# command = python /usr/app/scripts/erp_to_clickhouse.py

# Manuel tetikleme için webhook (Opsiyonel)
# [job-service-run "manuel_tetik"]
# schedule = @manually
# container = ${MUSTERI_ADI}_dbt
# command = dbt run
